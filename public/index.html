<html>

<head>
    <title>Gesture Talk</title>
    <style>
    .fullscreen {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
    }
    
    .column {
        display: flex;
        flex-direction: row;
    }
    
    .flex {
        flex: 1;
    }
    
    .main-panel {
        text-align: center;
    }
    
    .side-panel {
        width: 200px;
    }
    
    .empty-chatbox {
        height: 200px;
        width: 200px;
        line-height: 200px;
        background-color: red;
        border-radius: 200px;
        display: inline-block;
        top: 50%;
    }
    </style>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script type="text/javascript" src="lib/MyoJS-master/myo.js"></script>
    <script>
    Myo.connect();

    Myo.on('fingers_spread', function() {
        speak("Activation pose detected, connecting to chat room.", function(){
            joinRoom();
        });
    });

    var socket = io();

    socket.on('joined_room', function(id) {
        speak("Alexa, ask Gesture Talk to join the room with I.D. " + id);
    });

    socket.on('chatroom_begin', function() {
        speak('Successfully joined chatroom with Alexa.');
    });

    function joinRoom() {
        socket.emit('start_room');
    }

    function speak(text, callback) {
        var u = new SpeechSynthesisUtterance();
        u.text = text;
        u.lang = 'en-US';

        u.onend = function() {
            if (callback) {
                callback();
            }
        };

        u.onerror = function(e) {
            if (callback) {
                callback(e);
            }
        };

        speechSynthesis.speak(u);
    }
    </script>
</head>

<body class="fullscreen column">
    <div class="flex main-panel">
        <div class="empty-chatbox">Waiting for first message</div>
    </div>
    <div class="side-panel">
        <h1>Gesture Chat</h1> Welcome to the Gesture/Voice messaging app.
        </br>
        To begin, click 'Start Room' or 'Fingers spread' gesture
        </br>
        <button onclick="joinRoom()">Start Room</button>
    </div>
</body>

</html>